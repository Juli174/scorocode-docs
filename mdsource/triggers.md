#Триггеры

Триггеры - скрипты на JavaScript, выполняемые при определенных операциях над данными. Все триггеры выполняются 
в замыканиях, имеют локальный контекст. При выполнении триггера в его контексте создается объект ```DataManager``` и объект ```pool```.


##Объект ```pool```

В объект ```pool``` передаются следующие данные: 

Перед операцией ```insert```:

    {
        doc         : {}, // документ с парами имя_поля:значение
    }

После операции ```insert```:

    // нет

* * *

Перед операцией ```remove```:

    {
        query         : {}, // поисковый запрос, в соответствии с которым необходимо удалить документы
    }

После операции ```remove```:

    {
        count       : int // количество удаленных документов
        docs        : []  // массив ID удаленных документов
    }

* * *

Перед операцией ```update```:

    {
        doc         : {}, // документ с правилами обновления значений
        query       : {}, // поисковый запрос, в соответствии с которым необходимо обновить документы
    }

После операции ```update```:

    {
        count       : int // количество обновленный документов
        docs        : []  // массив ID обновленных документов
    }

* * *

Перед операцией ```updatebyid```:

    {
        doc         : {}, // документ с правилами обновления значений
        query       : {}, // поисковый запрос {"_id" : <ID документа>}
    }

После операции ```updatebyid```:

    {
        newDoc      : { } // обновленный документ
    }

* * *

##Объект ```DataManager```

Объект ```DataManager``` содержит следующие методы работы с данными:

###DataManager.Insert(data Object)

Метод для вставки документа в коллекцию.

Параметры:

```data Object``` - объект, содержащий следующие атрибуты:

    {
        coll        : "", // имя коллекции, обязательный
        doc         : {}, // документ с парами имя_поля:значение, необязательный
    }

Возвращаемое значение - ```Object```:

Выполнено

    {
        error       : false
        result      : {} // созданный документ
    }
Ошибка

    {
        error       : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

###DataManager.Remove(data Object)

Метод для удаления документов из коллекции.

Параметры:

```data Object``` - объект, содержащий следующие атрибуты:

    {
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный
        limit       : int // лимит количества удаляемых документов, необязательный, если не указан, то удалятся первые 1000 документов
    }

Возвращаемое значение - ```Object```:

Выполнено

    {
        error       : false
        result      : {
            count       : int, // количество удаленных документов
            docs        : [] // массив ID удаленных документов
        }
    }
Ошибка

    {
        error       : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

###DataManager.Update(data Object)

Метод для обновления документов в коллекции.

Параметры:

```data Object``` - объект, содержащий следующие атрибуты:

    {
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный
        doc         : {}, // документ с парами оператор:значение, обязательный
        limit       : int // лимит количества обновляемых документов, необязательный, если не указан, то обновятся первые 1000 документов
    }

Возвращаемое значение - ```Object```:

Выполнено

    {
        error       : false
        result      : {
            count       : int, // количество удаленных документов
            docs        : [] // массив ID измененных документов
        }
    }
Ошибка

    {
        error       : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

###DataManager.UpdateById(data Object)

Метод для обновления одного документа в коллекции, идентифицируемого по ID.

Параметры:

```data Object``` - объект, содержащий следующие атрибуты:

    {
        coll        : "", // имя коллекции, обязательный
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос в формате "_id" : "<идентификатор документа>, обязательный
        doc         : {}, // документ с парами оператор:значение, обязательный
    }

Возвращаемое значение - ```Object```:

Выполнено

    {
        error       : false
        result      : {} // обновленный документ
    }
Ошибка

    {
        error       : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

###DataManager.find(data Object)

Метод для запроса документов из коллекции.

Параметры:

```data Object``` - объект, содержащий следующие атрибуты:

    {
        coll        : "", // имя коллекции, обязательный
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный, если пустой, то будут возвращены первые 100 документов
        sort        : {}, // сортировка по полям в формате имя_поля:1/-1, необязательный
        fields      : [], // список имен полей, которые будут озвращены в каждом документе, необязательный
        limit       : int,// лимит размера выборки, необязательный, по умолчанию 50
        skip        : int,// количество документов, которое нужно пропустить в выборке
    }

Возвращаемое значение - ```Object```:

Выполнено

    {
        error       : false
        result      : [] // массив выбранных документов с учетом лимита
    }
Ошибка

    {
        error       : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

###DataManager.count(data Object)

Метод для запроса количества документов по условию в коллекции.

Параметры:

```data Object``` - объект, содержащий следующие атрибуты:

    {
        coll        : "", // имя коллекции, обязательный
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный
    }

Возвращаемое значение - ```Object```:

Выполнено

    {
        error       : false
        result      : int // количество документов
    }
Ошибка

    {
        error       : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

