##Общее описание протокола


    {
        app         : "ID приложения",
        cli         : "Ключ клиента (clientKey)",
        acc         : "Ключ доступа (accessKey)",
        sess        : "ID сессии, получается в ответ на метод login",
    
        username    : "имя пользователя",
        email       : "email пользователя",
        password    : "пароль",
    
        coll        : "Название коллекции",
        doc : {
            "имя поля"      : "значение",
            "имя поля"      : "значение"
        },
        query : {
            "имя поля"      : "значение",
            "объект.ключ"   : "значение",
            "оператор $"    : { }
        },
        sort        : {
            "имя поля"      : 1,
            "имя поля"      : -1
        },
        fields      : ["имя поля", "имя поля", "имя поля"],
        limit       : 100,
        skip        : 5,
    
        script      : "ID серверного скрипта",
        pool        : { },
    
        docId       : "ID документа",
        field       : "Имя поля"
        file        : "Имя файла",
        
        msg         : {
            subject         : "Заголовок",
            text            : "Текст",
            from            : "Имя отправителя",
            data            : { }
        }
    }
    
* * *

##/api/v1/register
Регистрация нового пользователя.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        username    : "", // имя пользователя, обязательный, минимум 5 символов
        email       : "", // email, обязательный
        password    : "", // пароль, обязательный, минимум 6 символов
        doc         : { } // значения пользовательских полей в коллекции 'users', необязательный
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/login
Авторизация пользователя.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        email       : "", // email, обязательный
        password    : "", // пароль, обязательный
    }

###Ответы
Выполнено

    {
        error         : false,
        result        : {
            sessionId       : "", // ID сессии
            user            : {}  // Документ, содержащий пользователя
        }
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/logout
Деавторизация пользователя.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        sess        : ""  // ID сессии, обязательный
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/data/insert
Вставка документа в коллекцию.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, необязательный, для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если ACLPublic приложения на операцию == false и acc != masterKey
        coll        : "", // имя коллекции, обязательный
        doc         : {}, // документ с парами имя_поля:значение, необязательный
    }

###Ответы
Выполнено

    {
        error         : false
        result      : {} // созданный документ
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/data/remove
Удаление документа из коллекции.

* Метод: POST
* Content-Type: application/json
* Ограничения: удаляет не более 1000 документов


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, необязательный, для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если ACLPublic приложения на операцию == false и acc != masterKey
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный
        limit       : int // лимит количества удаляемых документов, необязательный, если не указан, то удалятся первые 1000 документов
    }

###Ответы
Выполнено

    {
        error         : false
        result      : {
            count       : int, // количество удаленных документов
            docs        : [] // массив ID удаленных документов
        }
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/data/update
Изменение документов в коллекции.

* Метод: POST
* Content-Type: application/json
* Ограничения: изменяет не более 1000 документов


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, необязательный, для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если ACLPublic приложения на операцию == false и acc != masterKey
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный
        doc         : {}, // документ с парами оператор:значение, обязательный
        limit       : int // лимит количества обновляемых документов, необязательный, если не указан, то обновятся первые 1000 документов
    }

###Ответы
Выполнено

    {
        error         : false
        result      : {
            count       : int, // количество удаленных документов
            docs        : [] // массив ID измененных документов
        }
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/data/updatebyid
Изменение одного документа в коллекции.

* Метод: POST
* Content-Type: application/json
* Ограничения: изменяет не более 1000 документов


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, необязательный, для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если ACLPublic приложения на операцию == false и acc != masterKey
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос в формате "_id" : "<идентификатор документа>, обязательный
        doc         : {}, // документ с парами оператор:значение, обязательный
    }

###Ответы
Выполнено

    {
        error         : false
        result      : {} // обновленный документ
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/data/find
Запрос документов из коллекции.

* Метод: POST
* Content-Type: application/json
* Ограничения - возвращает не более 100 документов


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, необязательный, для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если ACLPublic приложения на операцию == false и acc != masterKey
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный, если пустой, то будут возвращены первые 100 документов
        sort        : {}, // сортировка по полям в формате имя_поля:1/-1, необязательный
        fields      : [], // список имен полей, которые будут озвращены в каждом документе, необязательный
        limit       : int,// лимит размера выборки, необязательный, по умолчанию 50
        skip        : int,// количество документов, которое нужно пропустить в выборке
    }

###Ответы
Выполнено

    {
        error         : false
        result      : string // bson результат запроса
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/data/count
Запрос количества документов из коллекции.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, необязательный, для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если ACLPublic приложения на операцию == false и acc != masterKey
        coll        : "", // имя коллекции, обязательный
        query       : {}, // запрос с парами имя_поля/оператор:значение, необязательный
    }

###Ответы
Выполнено

    {
        error         : false
        result      : int // количество документов
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/upload
Загрузка файла.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, fileKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        coll        : "", // имя коллекции, обязательный
        docId       : "", // ID документа, обязательный
        field       : "", // имя поля, обязательный
        file        : "", // имя файла, обязательный
        content     : ""  // тело файла в кодировке base64, обязательный
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/getfile
Получение файла.

* Метод: GET


    /api/v1/getfile/{app}/{coll}/{field}/{docId}/{file}
    , где:
    {app}     - идентификатор приложения, обязательный
    {coll}    - имя коллекции, обязательный
    {field}   - имя поля, обязательный
    {docId}   - идентификатор документа
    {file}    - имя файла

###Ответы
Status: 302 (Redirect на файл)

Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/getfilelink
Получение ссылки на файл.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, fileKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        coll        : "", // имя коллекции, обязательный
        docId       : "", // ID документа, обязательный
        field       : "", // имя поля, обязательный
        file        : ""  // имя файла, обязательный
    }

###Ответы
Выполнено

    {
        error         : false,
        result      : "Ссылка на файл"
    }

Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/deletefile
Удаление файла.

* Метод: POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, fileKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        coll        : "", // имя коллекции, обязательный
        docId       : "", // ID документа, обязательный
        field       : "", // имя поля, обязательный
        file        : ""  // имя файла, обязательный
    }

###Ответы
Выполнено

    {
        error         : false,
    }

Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/sendemail
Отправка email пользователям.

* Метод - POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, messageKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        query       : {}, // запрос в коллекцию users для выборки адресатов с парами имя_поля/оператор:значение, необязательный
        msg         : {
            subject     : "", // Тема письма
            text        : "", // Текст письма
            from        : ""  // Имя отправителя
        }
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/sendpush
Отправка push на устройства.

* Метод - POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, messageKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        query       : {}, // запрос в коллекцию devices для выборки адресатов с парами имя_поля/оператор:значение, необязательный
        msg         : {
            text        : "", // Текст сообщения
            data        : { } // объект с передаваемыми данными
        }
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/sendsms
Отправка sms на номера пользователей.

* Метод - POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, messageKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        query       : {}, // запрос в коллекцию users для выборки адресатов с парами имя_поля/оператор:значение, необязательный
        msg         : {
            text        : "", // Текст sms
        }
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/scripts
Отправка задания на выполнение серверного скрипта.

* Метод - POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : "", // ключ доступа, обязательный, scriptKey или для полного доступа masterKey
        sess        : "", // ID сессии, обязательный, если acc != masterKey
        script      : "", // ID скрипта, обязательный
        pool        : {}  // пул данных для установки передачи в контекст скрипта, необязательный
        
    }

###Ответы
Выполнено

    {
        error         : false
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *

##/api/v1/stat
Получение статистики по приложению.

* Метод - POST
* Content-Type: application/json


    {
        app         : "", // идентификатор приложения, обязательный
        cli         : "", // клиентский ключ, обязательный
        acc         : ""  // ключ доступа, обязательный, только masterKey
    }

###Ответы
Выполнено

    {
        error         : false
        results     : {
            dataSize    : int, // Размер данных приложения
            indexSize   : int, // Размер идексов приложения
            filesSize   : int  // Размер файлов приложения
        }
    }
Ошибка

    {
        error         : true,
        errCode     : 4XX/5XX, // Код ошибки
        errMsg      : "Текст ошибки"
    }

* * *


